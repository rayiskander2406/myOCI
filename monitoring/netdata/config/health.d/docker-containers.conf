# Critical Docker Container Health Monitoring
# Priority 1: NetBird, Zitadel, Caddy

# NetBird Management Container
alarm: netbird_management_down
   on: docker_engine.container_state
 lookup: average -1m percentage foreach running,*infrastructure_files-management-*
  every: 10s
   crit: $this == 0
  units: %
   info: NetBird Management container is down (CRITICAL)
     to: sysadmin

# NetBird Dashboard Container
alarm: netbird_dashboard_down
   on: docker_engine.container_state
 lookup: average -1m percentage foreach running,*infrastructure_files-dashboard-*
  every: 10s
   crit: $this == 0
  units: %
   info: NetBird Dashboard container is down (CRITICAL)
     to: sysadmin

# NetBird Signal Container
alarm: netbird_signal_down
   on: docker_engine.container_state
 lookup: average -1m percentage foreach running,*infrastructure_files-signal-*
  every: 10s
   crit: $this == 0
  units: %
   info: NetBird Signal container is down (CRITICAL)
     to: sysadmin

# NetBird Relay Container
alarm: netbird_relay_down
   on: docker_engine.container_state
 lookup: average -1m percentage foreach running,*infrastructure_files-relay-*
  every: 10s
   crit: $this == 0
  units: %
   info: NetBird Relay container is down (CRITICAL)
     to: sysadmin

# Zitadel Authentication Container
alarm: zitadel_down
   on: docker_engine.container_state
 lookup: average -1m percentage foreach running,*infrastructure_files-zitadel-*
  every: 10s
   crit: $this == 0
  units: %
   info: Zitadel authentication container is down (CRITICAL)
     to: sysadmin

# Caddy Reverse Proxy Container
alarm: caddy_down
   on: docker_engine.container_state
 lookup: average -1m percentage foreach running,*infrastructure_files-caddy-*
  every: 10s
   crit: $this == 0
  units: %
   info: Caddy reverse proxy container is down (CRITICAL)
     to: sysadmin

# PostgreSQL Database
alarm: postgres_down
   on: docker_engine.container_state
 lookup: average -1m percentage foreach running,*infrastructure_files-zdb-*
  every: 10s
   warn: $this == 0
  units: %
   info: PostgreSQL database container is down (HIGH PRIORITY)
     to: sysadmin

# Coturn TURN/STUN Server
alarm: coturn_down
   on: docker_engine.container_state
 lookup: average -1m percentage foreach running,*infrastructure_files-coturn-*
  every: 10s
   warn: $this == 0
  units: %
   info: Coturn TURN/STUN server is down (HIGH PRIORITY)
     to: sysadmin
